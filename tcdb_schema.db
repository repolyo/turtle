CREATE DATABASE tutorial_db;
CREATE USER 'tanch'@'localhost' IDENTIFIED BY 'tanch';
GRANT ALL PRIVILEGES ON * . * TO 'tanch'@'localhost';
FLUSH PRIVILEGES;

CREATE TABLE platform (
   pid INT(11) NOT NULL AUTO_INCREMENT,
   codeline VARCHAR(255) NOT NULL,
   persona VARCHAR(255) NOT NULL,
   version VARCHAR(255) NOT NULL,
   memory BIGINT(20) NOT NULL DEFAULT 0,
   disk BIGINT(20) NOT NULL DEFAULT 0,
   usb BOOLEAN not null default 0,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (pid)
);

CREATE TABLE testcase (
   tname VARCHAR(255) NOT NULL,   
   tloc VARCHAR(255) NOT NULL,  
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
   PRIMARY KEY (tloc)
);

CREATE TABLE tags (
   tag_name VARCHAR(255) NOT NULL,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (tname)
);

CREATE TABLE func (
   fid INT(11) NOT NULL AUTO_INCREMENT,
   source_file VARCHAR(255) NOT NULL,
   line_no INT(10),
   func_name VARCHAR(255) NOT NULL,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (source_file, func_name)
);

CREATE TABLE testcase_func_map (
   tloc VARCHAR(255) NOT NULL, 
   fid INT(11) NOT NULL,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (tloc,fid),
   FOREIGN KEY (tloc) REFERENCES testcase (tloc),
   FOREIGN KEY (fid) REFERENCES func (fid)
);

CREATE TABLE testcase_tags (
   tag_name VARCHAR(255) NOT NULL,
   tloc VARCHAR(255) NOT NULL, 
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (tag_name,tloc),
   FOREIGN KEY (tloc) REFERENCES testcase (tloc),
   FOREIGN KEY (tag_name) REFERENCES tags (tag_name)
);
