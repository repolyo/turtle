CREATE DATABASE tutorial_db;
CREATE USER 'tanch'@'localhost' IDENTIFIED BY 'tanch';
GRANT ALL PRIVILEGES ON * . * TO 'tanch'@'localhost';
FLUSH PRIVILEGES;

CREATE TABLE files (
   fname VARCHAR(255) NOT NULL,   
   floc VARCHAR(255) NOT NULL,  
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
   PRIMARY KEY (floc)
);

CREATE TABLE tags (
   tname VARCHAR(255) NOT NULL,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (tname)
);

CREATE TABLE func (
   source_file VARCHAR(255) NOT NULL,
   func_name VARCHAR(255) NOT NULL,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (source_file, func_name)
);

CREATE TABLE platform (
   pid INT(11) NOT NULL AUTO_INCREMENT,
   codeline VARCHAR(255) NOT NULL,
   persona VARCHAR(255) NOT NULL,
   version VARCHAR(255) NOT NULL,
   memory BIGINT(20) NOT NULL DEFAULT 0,
   disk BIGINT(20) NOT NULL DEFAULT 0,
   usb BOOLEAN not null default 0,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (pid)
);

CREATE TABLE file_func_map (
   pid INT(11) NOT NULL,
   floc VARCHAR(255) NOT NULL, 
   func VARCHAR(255) NOT NULL,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (pid,floc,func),
   FOREIGN KEY (pid) REFERENCES platform (pid),
   FOREIGN KEY (floc) REFERENCES files (floc),
   FOREIGN KEY (func_name) REFERENCES func (func_name)
);

CREATE TABLE file_tags (
   pid INT(11) NOT NULL,
   floc VARCHAR(255) NOT NULL, 
   tname VARCHAR(255) NOT NULL,
   create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
   PRIMARY KEY (pid,floc,tname),
   FOREIGN KEY (pid) REFERENCES platform (pid),
   FOREIGN KEY (floc) REFERENCES files (floc),
   FOREIGN KEY (tname) REFERENCES tags (tname)
);
